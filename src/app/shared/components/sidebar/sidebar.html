<mat-sidenav-container style="height: 94vh;">
  <mat-sidenav #sidenav [mode]="isMobile ? 'over' : 'side'" [opened]="!isMobile" class="custom-sidebar">
    <div class="sidebar-content-wrapper">
      @if (user) {
        <section class="profile-area">
          <img [src]="user.picture || '/no_profile_pic.png'" alt="Profile Picture" class="profile-pic" referrerpolicy="no-referrer">
          <h4 class="user-name">{{(user.displayName | displayNamePipe) || "Loading..."}}</h4>
          @if (tutorRating !== null) {
            <div class="tutor-rating">
              <mat-icon class="rating-icon">star</mat-icon>
              <span class="rating-value">{{ tutorRating > 0 ? (tutorRating.toFixed(1) + '/5') : 'N/A' }}</span>
            </div>
          }
        </section>
      }

      <mat-nav-list class="item-area">
        <ng-container *ngTemplateOutlet="itemList; context: { items: sideBarLinks }"></ng-container>
      </mat-nav-list>

      <div class="sidebar-footer">
        <app-theme-toggle-button></app-theme-toggle-button>
      </div>
    </div>
  </mat-sidenav>

  <mat-sidenav-content>
    <mat-toolbar color="primary">
      <button mat-icon-button (click)="sidenav.toggle()">
        <mat-icon>menu</mat-icon>
      </button>
    </mat-toolbar>
    
    <main class="content">
      <router-outlet></router-outlet>
    </main>
  </mat-sidenav-content>
</mat-sidenav-container>

<ng-template #itemList let-items="items">
  @for (item of items; track item.route) {
    @if (shouldShow(item)) {
      @if (item.children && item.children.length > 0) {
        <mat-expansion-panel class="expansion-panel">
          <mat-expansion-panel-header>
            <mat-icon matListItemIcon class="expansion-icon">{{ item.icon }}</mat-icon>
            <p matListItemTitle>{{ item.label }}</p>
          </mat-expansion-panel-header>
          <ng-container *ngTemplateOutlet="itemList; context: { items: item.children }"></ng-container>
        </mat-expansion-panel>
      } @else {
        <a mat-list-item
          [routerLink]="item.route"
          routerLinkActive="active-link"
          [routerLinkActiveOptions]="{exact: true}"
          (click)="isMobile && sidenav.close()">
          <mat-icon matListItemIcon>{{ item.icon }}</mat-icon>
          <p matListItemTitle>{{ item.label }}</p>
        </a>
      }
    }
  }
</ng-template>