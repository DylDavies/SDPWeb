<div class="calendar-container">
  <header class="calendar-header">
    <button mat-icon-button (click)="previousMonth()" aria-label="Previous month">
      <mat-icon>chevron_left</mat-icon>
    </button>
    <h1 class="current-month">{{ monthNames[currentDate.getMonth()] }} {{ currentDate.getFullYear() }}</h1>
    <button mat-icon-button (click)="nextMonth()" aria-label="Next month">
      <mat-icon>chevron_right</mat-icon>
    </button>
  </header>

  <!-- Desktop Grid View -->
  <div class="calendar-grid desktop-view">
    <div *ngFor="let dayName of weekDays" class="day-name-cell">
      {{ dayName }}
    </div>
    <button *ngFor="let day of daysInMonth"
         class="day-cell"
         [class.empty-cell]="!day"
         (click)="openAddEventDialog(day)"
         [disabled]="!day || !isStaffOrAdmin">
      <span *ngIf="day" class="day-number">{{ day.getDate() }}</span>
      <div *ngIf="day" class="event-container">
        <button *ngFor="let event of getEventsForDay(day)" class="event-chip" (click)="onEventClick(event, $event)" type="button">
          <div class="event-content">
            <span class="event-time">{{ getEventTime(event) }} - </span>
            <span class="event-name">{{ event.subject }}</span>
          </div>
          <ng-container [ngSwitch]="getEventStatusIcon(event)">
            <mat-icon *ngSwitchCase="'completed'" class="remark-icon">check_circle</mat-icon>
            <mat-icon *ngSwitchCase="'pending'" class="pending-icon">pending</mat-icon>
          </ng-container>
        </button>
      </div>
    </button>
  </div>

  <!-- Mobile Split View -->
  <div class="mobile-split-view">
    <div class="day-name-header-mobile">
      <div *ngFor="let dayName of weekDays" class="day-name-cell">
        {{ dayName }}
      </div>
    </div>
    <div class="mobile-mini-grid">
      <div *ngFor="let day of daysInMonth"
           class="mini-day-cell-wrapper"
           [class.empty-cell]="!day">
        <button *ngIf="day"
                class="mini-day-cell"
                (click)="selectDay(day)"
                [class.selected]="isSameDay(day, selectedDay)"
                [class.has-events]="getEventsForDay(day).length > 0">
          <span class="mini-day-number">{{ day.getDate() }}</span>
          <div class="event-dot-container">
            <div *ngFor="let event of getEventsForDay(day).slice(0, 3)" class="event-dot"></div>
          </div>
        </button>
      </div>
    </div>

    <div class="mobile-event-details">
      <ng-container *ngIf="selectedDay; else noDaySelected">
        <div class="details-header">
          <span>{{ selectedDay | date:'fullDate' }}</span>
          <button *ngIf="isStaffOrAdmin" mat-mini-fab color="primary" class="add-event-fab" (click)="openAddEventDialog(selectedDay)" aria-label="Add new event for selected day">
            <mat-icon>add</mat-icon>
          </button>
        </div>

        <div class="details-list">
          <ng-container *ngIf="getEventsForDay(selectedDay).length > 0; else noEvents">
            <button *ngFor="let event of getEventsForDay(selectedDay)" class="event-chip" (click)="onEventClick(event, $event)" type="button">
              <div class="event-content">
                <span class="event-time">{{ getEventTime(event) }} - </span>
                <span class="event-name">{{ event.subject }}</span>
              </div>
              <ng-container [ngSwitch]="getEventStatusIcon(event)">
                <mat-icon *ngSwitchCase="'completed'" class="remark-icon">check_circle</mat-icon>
                <mat-icon *ngSwitchCase="'pending'" class="pending-icon">pending</mat-icon>
              </ng-container>
            </button>
          </ng-container>
          <ng-template #noEvents>
            <div class="no-events-message">No events scheduled for this day.</div>
          </ng-template>
        </div>
      </ng-container>
      <ng-template #noDaySelected>
        <div class="no-events-message">Select a day to see event details.</div>
      </ng-template>
    </div>
  </div>
</div>
