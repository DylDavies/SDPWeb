<div class="profile-page-container">
  @if (isLoading) {
    <div class="loading-container">
      <mat-spinner></mat-spinner>
    </div>
  } @else {
    @if (userNotFound) {
      <div class="profile-card">
        <div class="profile-content">
          <div class="profile-header">
            <div class="profile-info">
              <h1>User Not Found</h1>
              <p>Sorry, a profile could not be found for the specified user.</p>
            </div>
            <div class="profile-actions">
              <button mat-stroked-button color="primary" (click)="redirectToDashboard()">
                <mat-icon>arrow_back</mat-icon>
                <span>Return to Dashboard</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    } @else if (user) {
      <div class="profile-card">
        <mat-tab-group animationDuration="0ms">
          
          <mat-tab label="Profile">
            <div class="profile-content">
              <div class="profile-header">
                <div class="profile-avatar-wrapper">
                  <img class="profile-avatar" 
                       [src]="user.picture || '/assets/no_profile_pic.png'" 
                       [alt]="'Profile picture of ' + ((user.displayName | displayNamePipe) || 'user')"
                       referrerpolicy="no-referrer">
                </div>
                <div class="profile-info">
                  <div class="editable-header">
                    <h1 class="display-name">{{ (user.displayName | displayNamePipe) || 'User' }}</h1>
                    @if (isOwnProfile) {
                      <button mat-icon-button (click)="editProfile()" class="edit-icon" matTooltip="Edit display name">
                        <mat-icon>edit</mat-icon>
                      </button>
                    }
                  </div>
                  <h2 class="user-role"  matTooltip="User type" aria-label="User type">{{ user.type | userTypePipe }}</h2>
                  <div class="roles-container" matTooltip="User roles" aria-label="User roles">
                    <app-role-chip-row [roles]="user.roles" ></app-role-chip-row>
                  </div>
                </div>
                <div class="profile-actions">
                @if (isOwnProfile) {
                  <button mat-stroked-button color="primary" (click)="openLeaveModal()">
                    <mat-icon>event_busy</mat-icon>
                    <span>Request Leave</span>
                  </button>
                }
                </div>
              </div>

              <mat-divider></mat-divider>

              <div class="profile-details">
                <div class="detail-item">
                  <mat-icon class="detail-icon" color="primary">mail_outline</mat-icon>
                  <div class="detail-text">
                    <span class="detail-label">Email Address</span>
                    <span class="detail-value">{{ user.email }}</span>
                  </div>
                </div>
                
                <div class="detail-item editable">
                  <mat-icon class="detail-icon" color="primary">event_available</mat-icon>
                  <div class="detail-text">
                    <span class="detail-label">Weekly Availability</span>
                    <span class="detail-value">
                      {{ (user.availability || 0) }} hours
                    </span>
                    @if (isOwnProfile) {
                      <button mat-icon-button (click)="openEditAvailabilityDialog()" class="edit-icon ava-edit-icon">
                        <mat-icon>edit</mat-icon>
                      </button>
                    }

                  </div>
                </div>

                <div class="detail-item">
                  <mat-icon class="detail-icon" color="primary">calendar_today</mat-icon>
                  <div class="detail-text">
                    <span class="detail-label">Member Since</span>
                    <span class="detail-value">{{ user.createdAt | date:'longDate' }}</span>
                  </div>
                </div>
              </div>
            </div>
          </mat-tab>
          
          <mat-tab label="Leave">
            <div class="profile-content">
              <h2>Leave Requests</h2>
              <app-leave-management [userId]="user._id"></app-leave-management>
            </div>
          </mat-tab>

          <mat-tab label="Proficiencies">
            <div class="profile-content">
              <app-proficiency-management></app-proficiency-management>
            </div>
          </mat-tab>

          <mat-tab label="Badges">
            <div class="profile-content">
              <app-badge-list [user]="user" (userUpdated)="loadUser()"></app-badge-list>
            </div>
          </mat-tab>
          
        </mat-tab-group>
      </div>
    }
  }
</div>