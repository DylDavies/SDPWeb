<div class="rate-history-dialog">
  <h2 mat-dialog-title>
    <mat-icon>history</mat-icon>
    Rate History for {{ user.displayName }}
  </h2>

  <mat-dialog-content>
    <div class="user-info">
      <span><strong>User:</strong> {{ user.displayName }} ({{ user.email }})</span>
    </div>

    <div *ngIf="adjustmentsWithApproverNames$ | async as adjustments; else loading" class="adjustments-container">
      <div *ngIf="adjustments.length === 0" class="no-history">
        <mat-icon color="warn">info</mat-icon>
        <p>No rate adjustment history found for this user.</p>
      </div>

      <table *ngIf="adjustments.length > 0" mat-table [dataSource]="adjustments" class="mat-elevation-z4">

        <!-- Effective Date Column -->
        <ng-container matColumnDef="effectiveDate">
          <th mat-header-cell *matHeaderCellDef>Effective Date</th>
          <td mat-cell *matCellDef="let adjustment">{{ adjustment.effectiveDate | date:'dd/MM/yyyy' }}</td>
        </ng-container>

        <!-- Rate Column -->
        <ng-container matColumnDef="rate">
          <th mat-header-cell *matHeaderCellDef>Rate</th>
          <td mat-cell *matCellDef="let adjustment">
            <span class="rate-value">{{ adjustment.newRate | currency:'R':'symbol':'1.2-2' }}/hr</span>
          </td>
        </ng-container>

        <!-- Reason Column -->
        <ng-container matColumnDef="reason">
          <th mat-header-cell *matHeaderCellDef>Reason</th>
          <td mat-cell *matCellDef="let adjustment">
            <span class="reason-text" [title]="adjustment.reason">{{ adjustment.reason }}</span>
          </td>
        </ng-container>

        <!-- Approving Manager Column -->
        <ng-container matColumnDef="approvingManager">
          <th mat-header-cell *matHeaderCellDef>Approved By</th>
          <td mat-cell *matCellDef="let adjustment">
            <div class="approver-info">
              <span class="approver-name">{{ adjustment.approverName }}</span>
              <span *ngIf="adjustment.approverEmail" class="approver-email">({{ adjustment.approverEmail }})</span>
            </div>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"
            [attr.data-index]="row.effectiveDate"></tr>
      </table>
    </div>

    <ng-template #loading>
      <div class="loading-spinner">
        <mat-spinner></mat-spinner>
        <p>Loading rate history...</p>
      </div>
    </ng-template>
  </mat-dialog-content>

  <mat-dialog-actions align="end">
    <button mat-raised-button color="primary" (click)="onClose()">
      <mat-icon>close</mat-icon>
      Close
    </button>
  </mat-dialog-actions>
</div>